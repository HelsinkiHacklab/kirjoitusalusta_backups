<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-type"/>
  <meta content="en-us" http-equiv="Content-Language"/>
  <title>
   /hacklab-kurssi-digi-3
  </title>
 </head>
 <body>
  Tämä sivu:
  <a href="./hacklab-kurssi-digi-3.html">
   https://kirjoitusalusta.fi/hacklab-kurssi-digi-3
  </a>
  <br/>
  <br/>
  Torstai 19.5.2016, vga output:
  <br/>
  <a href="https://www.dropbox.com/sh/07v9sjesnbrsqqq/AACdB6srEjuo6GExyk2mfpSBa?dl=0">
   https://www.dropbox.com/sh/07v9sjesnbrsqqq/AACdB6srEjuo6GExyk2mfpSBa?dl=0
  </a>
  <br/>
  <br/>
  Tostai 12.5.2016, serial port:
  <br/>
  <a href="https://www.dropbox.com/sh/gkjqg5e2e8eju9r/AADwrO99DRRUTEEj3bxE5ssva?dl=0">
   https://www.dropbox.com/sh/gkjqg5e2e8eju9r/AADwrO99DRRUTEEj3bxE5ssva?dl=0
  </a>
  <br/>
  <br/>
  <br/>
  <b>
   Digitaalitekniikka-3, FPGA-jatko
  </b>
  <br/>
  <br/>
  <b>
   --------------------8&lt;-----------------------8&lt;-----------------------8&lt;-----------------------8&lt;---
  </b>
  <br/>
  <br/>
  // clock.v
  <br/>
  <br/>
  `timescale 1ns / 1ps
  <br/>
  `default_nettype none
  <br/>
  <br/>
  <br/>
  module ClockScaler #(
  <br/>
  parameter                    INPUT_CLOCK_PERIOD_NS = 0,
  <br/>
  parameter                    MULTIPLY = 2,                    // Multiply value 2..256
  <br/>
  parameter                    DIVIDE = 2                        // Divide value  1..256
  <br/>
  ) (
  <br/>
  input    wire                 input_clock,
  <br/>
  output    wire                 output_clock
  <br/>
  );
  <br/>
  <br/>
  /*
  <br/>
  DCM_CLKGEN #(
  <br/>
  .CLKIN_PERIOD(INPUT_CLOCK_PERIOD_NS),        // Input clock period specified in ns
  <br/>
  .CLKFX_MULTIPLY(MULTIPLY),                     // Multiply value - M - (2-256)
  <br/>
  .CLKFX_DIVIDE(DIVIDE),                         // Divide value - D - (1-256)
  <br/>
  .SPREAD_SPECTRUM("NONE"),                   // Spread Spectrum mode "NONE", "CENTER_LOW_SPREAD", "CENTER_HIGH_SPREAD", "VIDEO_LINK_M0", "VIDEO_LINK_M1" or "VIDEO_LINK_M2"
  <br/>
  .STARTUP_WAIT("TRUE")                       // Delay config DONE until DCM_CLKGEN LOCKED (TRUE/FALSE)
  <br/>
  ) dcm0(
  <br/>
  .CLKIN(input_clock),                         // 1-bit input: Input clock
  <br/>
  .RST(1'b0),                                 // 1-bit input: Reset input pin
  <br/>
  .FREEZEDCM(1'b0),                           // 1-bit input: Prevents frequency adjustments to input clock
  <br/>
  <br/>
  .PROGCLK(),                                    // 1-bit input: Clock input for M/D reconfiguration
  <br/>
  .PROGDATA(),                                   // 1-bit input: Serial data input for M/D reconfiguration
  <br/>
  .PROGEN(),                                     // 1-bit input: Active high program enable
  <br/>
  .LOCKED(),                                    // 1-bit output: Locked output
  <br/>
  .CLKFX180(),                                // 1-bit output: Generated clock output 180 degree out of phase from CLKFX.
  <br/>
  .CLKFXDV(),                                 // 1-bit output: Divided clock output
  <br/>
  .PROGDONE(),                                // 1-bit output: Active high output to indicate the successful re-programming
  <br/>
  .STATUS(),                                  // 2-bit output: DCM_CLKGEN status
  <br/>
  <br/>
  .CLKFX(output_clock)                         // 1-bit output: Generated clock output
  <br/>
  );
  <br/>
  */
  <br/>
  <br/>
  wire                                 output_clock_unbuf;
  <br/>
  wire                                 pll_feedback;
  <br/>
  PLL_BASE #(
  <br/>
  .CLKIN_PERIOD(INPUT_CLOCK_PERIOD_NS),
  <br/>
  .CLKFBOUT_MULT(MULTIPLY),                    // Multiply value 1..64
  <br/>
  .CLKOUT0_DIVIDE(DIVIDE),                    // Divide value 1..128
  <br/>
  .CLKOUT0_PHASE(0.0),
  <br/>
  .CLK_FEEDBACK("CLKFBOUT"),
  <br/>
  .COMPENSATION("INTERNAL"),
  <br/>
  .DIVCLK_DIVIDE(1),
  <br/>
  .RESET_ON_LOSS_OF_LOCK("FALSE")
  <br/>
  ) pll_base_px(
  <br/>
  .CLKIN(input_clock),
  <br/>
  .RST(1'b0),
  <br/>
  .CLKFBIN(pll_feedback),
  <br/>
  <br/>
  .CLKOUT0(output_clock_unbuf),
  <br/>
  .CLKOUT1(),
  <br/>
  .CLKOUT2(),
  <br/>
  .CLKOUT3(),
  <br/>
  .CLKOUT4(),
  <br/>
  .CLKOUT5(),
  <br/>
  <br/>
  .CLKFBOUT(pll_feedback),
  <br/>
  .LOCKED()
  <br/>
  );
  <br/>
  <br/>
  BUFG bufg_clk_px (
  <br/>
  .I(output_clock_unbuf),
  <br/>
  .O(output_clock)
  <br/>
  );
  <br/>
  <br/>
  endmodule
  <br/>
  <br/>
  <br/>
  <br/>
  <b>
   --------------------8&lt;-----------------------8&lt;-----------------------8&lt;-----------------------8&lt;---
  </b>
  <br/>
  <br/>
  // main.v
  <br/>
  <br/>
  `timescale 1ns / 1ps
  <br/>
  `default_nettype none
  <br/>
  <br/>
  <br/>
  module Main #(
  <br/>
  parameter                    EXTERNAL_CLOCK_FREQUENCY_HZ = X00_000_000,
  <br/>
  parameter                    EXTERNAL_CLOCK_PERIOD_NS = 1000000000.0/EXTERNAL_CLOCK_FREQUENCY_HZ
  <br/>
  ) (
  <br/>
  input wire                     EXTERNAL_CLOCK,
  <br/>
  <br/>
  output wire     [7:0]        LED
  <br/>
  );
  <br/>
  <br/>
  initial $display("Main # EXTERNAL_CLOCK_FREQUENCY_HZ = %.3f", EXTERNAL_CLOCK_FREQUENCY_HZ);
  <br/>
  initial $display("Main # EXTERNAL_CLOCK_PERIOD_NS = %.3f", EXTERNAL_CLOCK_PERIOD_NS);
  <br/>
  <br/>
  parameter LOGIC_CLOCK_MULTIPLY =    5;
  <br/>
  parameter LOGIC_CLOCK_DIVIDE =        2;
  <br/>
  parameter LOGIC_CLOCK_HZ =            (EXTERNAL_CLOCK_FREQUENCY_HZ*1.0*LOGIC_CLOCK_MULTIPLY)/LOGIC_CLOCK_DIVIDE;
  <br/>
  <br/>
  initial $display("Main # LOGIC_CLOCK_MHZ = %.3f", LOGIC_CLOCK_HZ/1000000.0);
  <br/>
  <br/>
  wire     external_clock;
  <br/>
  IBUFG ibufg0(
  <br/>
  .I(EXTERNAL_CLOCK),
  <br/>
  .O(external_clock)
  <br/>
  );
  <br/>
  <br/>
  wire     logic_clock;
  <br/>
  ClockScaler #(
  <br/>
  .INPUT_CLOCK_PERIOD_NS(EXTERNAL_CLOCK_PERIOD_NS),
  <br/>
  .MULTIPLY(LOGIC_CLOCK_MULTIPLY),
  <br/>
  .DIVIDE(LOGIC_CLOCK_DIVIDE)
  <br/>
  ) clock_scaler(
  <br/>
  .input_clock(external_clock),
  <br/>
  .output_clock(logic_clock)
  <br/>
  );
  <br/>
  <br/>
  parameter COUNTER_BITS =    16;
  <br/>
  <br/>
  reg            [COUNTER_BITS-1:0]            counter = 1'd0;
  <br/>
  reg            [COUNTER_BITS-1:0]            counter2 = 1'd0;
  <br/>
  <br/>
  always @ (posedge logic_clock) begin
  <br/>
  counter &lt;= counter + 1'd1;
  <br/>
  counter2 &lt;= counter;
  <br/>
  end
  <br/>
  <br/>
  assign LED = counter2[COUNTER_BITS-1:COUNTER_BITS-8];
  <br/>
  <br/>
  endmodule
  <br/>
  <br/>
  <br/>
  <br/>
  <b>
   --------------------8&lt;-----------------------8&lt;-----------------------8&lt;-----------------------8&lt;---
  </b>
  <br/>
  <br/>
  <br/>
  # board-mimas-xc6slx9-csg324-2.ucf
  <br/>
  #
  <br/>
  # Board: Numato MIMAS V2
  <br/>
  # Family: Spartan-6
  <br/>
  # Device: LX9
  <br/>
  # Package: CSG324
  <br/>
  # Speed: -2
  <br/>
  <br/>
  CONFIG VCCAUX = 3.3;
  <br/>
  <br/>
  # External oscillators
  <br/>
  NET "EXTERNAL_CLOCK"                LOC = "V10" | IOSTANDARD = LVCMOS33 | PERIOD = 100 MHz; # = 10 ns;
  <br/>
  #NET "EXTERNAL_CLOCK"                LOC = "D9"     | IOSTANDARD = LVCMOS33 | PERIOD = 12 MHz; # = 83.33 ns;
  <br/>
  <br/>
  NET "LED[7]"                        LOC = "P15" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D1
  <br/>
  NET "LED[6]"                        LOC = "P16" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D2
  <br/>
  NET "LED[5]"                        LOC = "N15" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D3
  <br/>
  NET "LED[4]"                        LOC = "N16" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D4
  <br/>
  NET "LED[3]"                        LOC = "U17" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D5
  <br/>
  NET "LED[2]"                        LOC = "U18" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D6
  <br/>
  NET "LED[1]"                        LOC = "T17" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D7
  <br/>
  NET "LED[0]"                        LOC = "T18" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;  #D8
  <br/>
  <br/>
  <br/>
  <br/>
  <b>
   --------------------8&lt;-----------------------8&lt;-----------------------8&lt;-----------------------8&lt;---
  </b>
  <br/>
  <br/>
  <br/>
  # board-minispartan-xc6slx25-ftg256-3.ucf
  <br/>
  #
  <br/>
  # Board: Scarab miniSpartan6+ Rev B
  <br/>
  # Family: Spartan-6
  <br/>
  # Device: LX25
  <br/>
  # Package: FTG256
  <br/>
  # Speed: -3
  <br/>
  <br/>
  CONFIG VCCAUX = 3.3;
  <br/>
  <br/>
  # External oscillator
  <br/>
  NET "EXTERNAL_CLOCK"  LOC = "K3" | IOSTANDARD = LVCMOS33 | PERIOD = 50 MHz; # = 20 ns;
  <br/>
  <br/>
  <br/>
  NET "LED[0]"                        LOC = "P11" | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[1]"                        LOC = "N9"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[2]"                        LOC = "M9"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[3]"                        LOC = "P9"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[4]"                        LOC = "T8"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[5]"                        LOC = "N8"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[6]"                        LOC = "P8"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  NET "LED[7]"                        LOC = "P7"  | IOSTANDARD = LVCMOS33 | DRIVE=8 | SLEW=SLOW;
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
 </body>
</html>